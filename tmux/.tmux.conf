# Enable Ctrl+Backspace to delete words
set -g default-terminal "xterm-256color"
bind-key -n C-BSpace send-keys C-w
bind-key -n C-H send-keys C-w

# ----------------------------
# Common Prefix Change
# ----------------------------
# Many people change prefix from Ctrl-b to Ctrl-a (easier to reach)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# ----------------------------
# Better Keybindings
# ----------------------------
# Reload config with prefix + r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes with | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Navigate panes with Alt + arrow keys (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Navigate panes with Ctrl + hjkl (vim style, no prefix needed)
bind -n C-h select-pane -L
bind -n C-l select-pane -R
bind -n C-k select-pane -U
bind -n C-j select-pane -D

# Resize panes with prefix + HJKL
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Switch windows with Shift + arrow (no prefix needed)
bind -n S-Left previous-window
bind -n S-Right next-window

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# ----------------------------
# Quality of Life
# ----------------------------
# Start window/pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Enable mouse support
set -g mouse on

# Increase scrollback buffer
set -g history-limit 50000

# Reduce escape delay (important for vim)
set -sg escape-time 10

# Enable focus events
set -g focus-events on

# ----------------------------
# Status Bar
# ----------------------------
set -g status-interval 2
set -g status-position bottom

# Colors
set -g status-style "bg=#1a1b26,fg=#a9b1d6"

# Left: session name + key reference (compact) + working dir
set -g status-left-length 120
set -g status-left "#[fg=#7aa2f7,bold] #S #[fg=#565f89]| #[fg=#565f89,italics]^a: |/- split  ^d close  ^a+z zoom #[fg=#565f89]| #[fg=#c0caf5]#(echo '#{pane_current_path}' | rev | cut -d'/' -f1-3 | rev) #[fg=#565f89]|"

# Right: git branch with [~dirty +ahead -behind], CPU, disk, date/time
# Git repo resolution: use pane path, fallback to cinify-core subdir
set -g status-right-length 150
set -g status-right "#[fg=#9ece6a]#(p=#{pane_current_path}; if git -C \"$p\" rev-parse --git-dir >/dev/null 2>&1; then cd \"$p\"; elif [ -d \"$p/cinify-core\" ]; then cd \"$p/cinify-core\"; else exit; fi; git rev-parse --abbrev-ref HEAD 2>/dev/null | xargs -I{} echo ' {}') #(p=#{pane_current_path}; if git -C \"$p\" rev-parse --git-dir >/dev/null 2>&1; then cd \"$p\"; elif [ -d \"$p/cinify-core\" ]; then cd \"$p/cinify-core\"; else exit; fi; echo '[')#[fg=#f7768e]#(p=#{pane_current_path}; if git -C \"$p\" rev-parse --git-dir >/dev/null 2>&1; then cd \"$p\"; elif [ -d \"$p/cinify-core\" ]; then cd \"$p/cinify-core\"; else exit; fi; git status --porcelain 2>/dev/null | wc -l | xargs -I{} echo '~{}')#[fg=#e0af68]#(p=#{pane_current_path}; if git -C \"$p\" rev-parse --git-dir >/dev/null 2>&1; then cd \"$p\"; elif [ -d \"$p/cinify-core\" ]; then cd \"$p/cinify-core\"; else exit; fi; git rev-list @{u}..HEAD --count 2>/dev/null | xargs -I{} echo '+{}')#[fg=#7dcfff]#(p=#{pane_current_path}; if git -C \"$p\" rev-parse --git-dir >/dev/null 2>&1; then cd \"$p\"; elif [ -d \"$p/cinify-core\" ]; then cd \"$p/cinify-core\"; else exit; fi; git rev-list HEAD..@{u} --count 2>/dev/null | xargs -I{} echo '-{}')#[fg=#a9b1d6]#(p=#{pane_current_path}; if git -C \"$p\" rev-parse --git-dir >/dev/null 2>&1; then cd \"$p\"; elif [ -d \"$p/cinify-core\" ]; then cd \"$p/cinify-core\"; else exit; fi; echo ']') #[fg=#565f89]| #[fg=#bb9af7]CPU #(top -bn1 | grep 'Cpu(s)' | awk '{print 100-$8}' | cut -d. -f1)%% #[fg=#565f89]| #[fg=#f7768e]Disk #(df -h / | awk 'NR==2 {gsub(\"%%\",\"\"); print $5}')%% #[fg=#565f89]| #[fg=#7dcfff]%H:%M #[fg=#565f89]| #[fg=#c0caf5]%d-%b"

# Window status
setw -g window-status-format "#[fg=#565f89] #I:#W "
setw -g window-status-current-format "#[fg=#7aa2f7,bold] #I:#W* "

# Pane borders
set -g pane-border-style "fg=#565f89"
set -g pane-active-border-style "fg=#7aa2f7"
